# F方法 - 计算函数

## 📋 F方法概述

**F方法（Formula Method）**是GainLab Script的核心，提供64个专业的技术分析计算函数，涵盖移动平均、技术指标、数学统计等各个方面。

### 🎯 核心特点
- 📊 **专业全面** - 涵盖所有主流技术分析指标
- ⚡ **高性能** - 优化的算法实现，支持大量K线数据
- 🔒 **数据安全** - 自动处理null值和边界情况
- 🎛️ **灵活易用** - 统一的接口设计，支持多种数据源

### ⚠️ 核心约束
- **✅ 严格参数顺序** - 必须按文档指定的参数顺序调用
- **✅ 数据类型匹配** - 确保传入正确的数据类型  
- **✅ 处理返回null** - F方法可能返回null值，需要适当处理
- **✅ 不支持自定义函数** - 只能使用官方提供的F方法

## 🗂️ F方法分类索引

### 📈 移动平均类（16个方法）
| 方法 | 功能 | 使用频率 | 复杂度 |
|------|------|---------|-------|
| [F.ma()](#F.ma) | 简单移动平均 | 🔥 极高 | ⭐ 简单 |
| [F.ema()](#F.ema) | 指数移动平均 | 🔥 极高 | ⭐ 简单 |
| [F.sma()](#F.sma) | 平滑移动平均 | 📊 高 | ⭐ 简单 |
| [F.wma()](#F.wma) | 加权移动平均 | 📊 高 | ⭐ 简单 |
| [F.rma()](#F.rma) | 威尔德移动平均 | 📊 高 | ⭐ 简单 |
| [F.rmaWithAlpha()](#F.rmaWithAlpha) | 自定义平滑因子RMA | 📊 中等 | ⭐⭐ 中等 |
| [F.dema()](#F.dema) | 双重指数移动平均 | 📝 中等 | ⭐⭐ 中等 |
| [F.tema()](#F.tema) | 三重指数移动平均 | 📝 中等 | ⭐⭐ 中等 |
| [F.hma()](#F.hma) | 赫尔移动平均 | 📝 中等 | ⭐⭐ 中等 |
| [F.tma()](#F.tma) | 三角移动平均（SMA of SMA） | 📝 中等 | ⭐⭐ 中等 |
| [F.lsma()](#F.lsma) | 最小二乘移动平均 | 📝 中等 | ⭐⭐ 中等 |
| [F.jma()](#F.jma) | Jurik移动平均 | 📝 中等 | ⭐⭐⭐ 复杂 |
| [F.t3()](#F.t3) | T3移动平均 | 📝 中等 | ⭐⭐ 中等 |
| [F.kama()](#F.kama) | 自适应移动平均 | 📝 中等 | ⭐⭐ 中等 |
| [F.trima()](#F.trima) | 三角移动平均线 | 📝 低 | ⭐⭐ 中等 |
| [F.mcginley()](#F.mcginley) | McGinley动态平均 | 📝 低 | ⭐⭐ 中等 |
| [F.edsma()](#F.edsma) | Ehlers动态平滑移动平均 | 📝 低 | ⭐⭐⭐ 复杂 |
| [F.vama()](#F.vama) | 成交量加权移动平均 | 📝 低 | ⭐⭐ 中等 |

### 📊 技术指标类（11个方法）
| 方法 | 功能 | 使用频率 | 复杂度 |
|------|------|---------|-------|
| [F.macd()](#F.macd) | MACD指标 | 🔥 极高 | ⭐⭐ 中等 |
| [F.rsi()](#F.rsi) | 相对强弱指数 | 🔥 极高 | ⭐⭐ 中等 |
| [F.boll()](#F.boll) | 布林带 | 🔥 极高 | ⭐⭐ 中等 |
| [F.kdj()](#F.kdj) | KDJ指标 | 🔥 高 | ⭐⭐ 中等 |
| [F.cci()](#F.cci) | 顺势指标 | 📊 高 | ⭐⭐ 中等 |
| [F.mtm()](#F.mtm) | 动量指标 | 📊 高 | ⭐ 简单 |
| [F.roc()](#F.roc) | 变动率 | 📊 高 | ⭐ 简单 |
| [F.wr()](#F.wr) | 威廉指标 | 📊 高 | ⭐⭐ 中等 |
| [F.stochastic()](#F.stochastic) | 随机指标 | 📊 高 | ⭐⭐ 中等 |
| [F.dmi()](#F.dmi) | 动向指数 | 📝 中等 | ⭐⭐⭐ 复杂 |
| [F.adxWithRMA()](#F.adxWithRMA) | ADX指标 | 📝 中等 | ⭐⭐⭐ 复杂 |
| [F.trix()](#F.trix) | 三重指数平滑指标 | 📝 中等 | ⭐⭐ 中等 |
| [F.brar()](#F.brar) | 人气意愿指标 | 📝 低 | ⭐⭐ 中等 |
| [F.vr()](#F.vr) | 成交量变异率 | 📝 低 | ⭐⭐ 中等 |
| [F.psy()](#F.psy) | 心理线 | 📝 低 | ⭐ 简单 |

### 📈 价量分析类（6个方法）
| 方法 | 功能 | 使用频率 | 复杂度 |
|------|------|---------|-------|
| [F.obv()](#F.obv) | 能量潮指标 | 📊 高 | ⭐ 简单 |
| [F.emv()](#F.emv) | 简易波动指标 | 📝 中等 | ⭐⭐ 中等 |
| [F.vo()](#F.vo) | 量价指标 | 📝 中等 | ⭐⭐ 中等 |
| [F.mfi()](#F.mfi) | 资金流量指标 | 📝 中等 | ⭐⭐ 中等 |
| [F.moneyFlow()](#F.moneyFlow) | 资金流量 | 📝 低 | ⭐ 简单 |
| [F.mf()](#F.mf) | 市场促进指数/资金流 | 📝 低 | ⭐ 简单 |

### 🌊 波动率分析类（5个方法）
| 方法 | 功能 | 使用频率 | 复杂度 |
|------|------|---------|-------|
| [F.atr()](#F.atr) | 平均真实波幅 | 🔥 极高 | ⭐⭐ 中等 |
| [F.tr()](#F.tr) | 真实波幅 | 🔥 高 | ⭐ 简单 |
| [F.atrWithRMA()](#F.atrWithRMA) | RMA平滑ATR | 📊 高 | ⭐⭐ 中等 |
| [F.std()](#F.std) | 标准差 | 📊 高 | ⭐⭐ 中等 |
| [F.calcVolatility()](#F.calcVolatility) | 年化波动率 | 📝 中等 | ⭐⭐ 中等 |

### 📊 统计分析类（9个方法）
| 方法 | 功能 | 使用频率 | 复杂度 |
|------|------|---------|-------|
| [F.attr()](#F.attr) | 属性提取 | 🔥 极高 | ⭐ 简单 |
| [F.hhv()](#F.hhv) | 最高值 | 🔥 极高 | ⭐ 简单 |
| [F.llv()](#F.llv) | 最低值 | 🔥 极高 | ⭐ 简单 |
| [F.avg()](#F.avg) | 平均值 | 📊 高 | ⭐ 简单 |
| [F.high()](#F.high) | 数组最高值 | 📊 高 | ⭐ 简单 |
| [F.low()](#F.low) | 数组最低值 | 📊 高 | ⭐ 简单 |
| [F.slope()](#F.slope) | 线性回归斜率 | 📝 中等 | ⭐⭐ 中等 |
| [F.linreg()](#F.linreg) | 线性回归值 | 📝 中等 | ⭐⭐ 中等 |
| [F.bias()](#F.bias) | 乖离率 | 📝 中等 | ⭐⭐ 中等 |

### 🔄 信号分析类（4个方法）
| 方法 | 功能 | 使用频率 | 复杂度 |
|------|------|---------|-------|
| [F.cross()](#F.cross) | 交叉检测 | 🔥 极高 | ⭐ 简单 |
| [F.throughUp()](#F.throughUp) | 上穿检测 | 🔥 极高 | ⭐ 简单 |
| [F.throughDown()](#F.throughDown) | 下穿检测 | 🔥 极高 | ⭐ 简单 |
| [F.getTrend()](#F.getTrend) | 趋势判断 | 📊 高 | ⭐⭐ 中等 |

### 🧮 特殊工具类（7个方法）
| 方法 | 功能 | 使用频率 | 复杂度 |
|------|------|---------|-------|
| [F.call()](#F.call) | 动态调用 | 📊 高 | ⭐ 简单 |
| [F.donchianChannel()](#F.donchianChannel) | 唐奇安通道 | 📝 中等 | ⭐⭐ 中等 |
| [F.fibonacciRetracement()](#F.fibonacciRetracement) | 斐波那契回调位 | 📝 中等 | ⭐⭐ 中等 |
| [F.sar()](#F.sar) | 抛物转向 | 📝 中等 | ⭐⭐⭐ 复杂 |
| [F.kijunV2()](#F.kijunV2) | 改进基准线 | 📝 低 | ⭐⭐ 中等 |
| [F.asi()](#F.asi) | 振动升降指标 | 📝 低 | ⭐⭐ 中等 |
| [F.dma()](#F.dma) | 平均线差 | 📝 低 | ⭐⭐ 中等 |

## 🔧 核心工具方法

### F.attr() - 属性提取

从对象数组中提取指定属性的值，是使用频率最高的F方法之一。

#### 语法格式
```javascript
F.attr(list, attr)
```

#### 参数详解
| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| `list` | array | ✅ | 对象数组 |
| `attr` | string | ✅ | 属性名称 |

#### 支持的计算属性
```javascript
// K线基础属性
F.attr(dataList, 'open')      // 开盘价数组
F.attr(dataList, 'high')      // 最高价数组
F.attr(dataList, 'low')       // 最低价数组
F.attr(dataList, 'close')     // 收盘价数组
F.attr(dataList, 'volume')    // 成交量数组
F.attr(dataList, 'turnover')  // 成交额数组

// K线组合计算属性
F.attr(dataList, 'hl2')       // (最高价+最低价) / 2
F.attr(dataList, 'oc2')       // (开盘价+收盘价) / 2  
F.attr(dataList, 'hlc3')      // (最高价+最低价+收盘价) / 3
F.attr(dataList, 'ohl3')      // (最高价+最低价+开盘价) / 3
F.attr(dataList, 'ohlc4')     // (最高价+最低价+开盘价+收盘价) / 4
F.attr(dataList, 'percentage') // 涨跌幅百分比

// 指标结果属性提取
macdResult = F.macd(dataList, 12, 26, 9)
F.attr(macdResult, 'dif')     // 提取DIF值
F.attr(macdResult, 'dea')     // 提取DEA值
F.attr(macdResult, 'macd')    // 提取MACD值
```

#### 实用示例
```javascript
//@name=多数据源对比
//@position=main
//@version=1

// 提取不同类型的价格数据
closeData = F.attr(dataList, 'close')      // 收盘价
hl2Data = F.attr(dataList, 'hl2')          // 中间价
hlc3Data = F.attr(dataList, 'hlc3')        // 典型价
ohlc4Data = F.attr(dataList, 'ohlc4')      // 平均价

// 分别计算MA
ma_close = F.ma(dataList, 20, 'close')
ma_hl2 = F.ma(dataList, 20, 'hl2')  
ma_hlc3 = F.ma(dataList, 20, 'hlc3')

// 样式和绘图
closeStyle = S.line('#FF0000', 2, 'solid', title='收盘价MA')
hl2Style = S.line('#00FF00', 1, 'dashed', title='中间价MA')
hlc3Style = S.line('#0000FF', 1, 'dotted', title='典型价MA')

D.line(ma_close, closeStyle)
D.line(ma_hl2, hl2Style)
D.line(ma_hlc3, hlc3Style)
```

## 📈 移动平均方法

### F.ma() - 简单移动平均

计算简单移动平均（Simple Moving Average），最基础也是使用最广泛的平均线指标。

#### 语法格式
```javascript
F.ma(list, period, attr?)
```

#### 参数详解
| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| `list` | array | ✅ | K线数据数组或数值数组 |
| `period` | number | ✅ | 计算周期（≥1） |
| `attr` | string | ❌ | 属性名称（仅对象数组需要） |

#### 返回值
返回数组，不足周期的位置返回null。

#### 基础示例
```javascript
// 基础用法
ma20 = F.ma(dataList, 20, 'close')       // 20周期收盘价MA
ma50 = F.ma(dataList, 50, 'hlc3')        // 50周期典型价MA

// 数值数组用法
prices = [100, 101, 99, 102, 105, 103]
ma3 = F.ma(prices, 3)                    // 直接对数值数组计算MA
```

#### 实战示例 - 经典双均线系统
```javascript
//@name=双均线系统
//@position=main
//@version=1

// 参数定义
fastPeriod = I.int(5, '快线周期', 1, 50)
slowPeriod = I.int(20, '慢线周期', 5, 200)
source = I.select('close', SOURCE, '数据源')

// 样式定义
fastStyle = S.line('#FF0000', 2, 'solid', title='快线')
slowStyle = S.line('#0000FF', 2, 'solid', title='慢线')

// 计算移动平均
fastMA = F.ma(dataList, fastPeriod, source)
slowMA = F.ma(dataList, slowPeriod, source)

// 信号计算
buySignals = F.throughUp(fastMA, slowMA)     // 金叉信号
sellSignals = F.throughDown(fastMA, slowMA)  // 死叉信号

// 绘制图形
D.line(fastMA, fastStyle)
D.line(slowMA, slowStyle)

// 输出
setPrecision('price')
O.tools('快线MA' + fastPeriod, fastMA, fastStyle)
O.tools('慢线MA' + slowPeriod, slowMA, slowStyle)
```

### F.ema() - 指数移动平均

计算指数移动平均（Exponential Moving Average），对近期价格赋予更高权重。

#### 语法格式
```javascript
F.ema(list, period, attr?)
```

#### 特点说明
- **更敏感**: 比SMA对价格变化反应更快
- **无滞后**: 减少传统MA的滞后性
- **平滑性**: 保持较好的平滑效果

#### 示例对比
```javascript
// EMA vs MA 对比
ma20 = F.ma(dataList, 20, 'close')       // 传统移动平均
ema20 = F.ema(dataList, 20, 'close')     // 指数移动平均

// EMA对价格变化更敏感，更快响应趋势变化
```

### F.sma() - 平滑移动平均

计算平滑移动平均（Smoothed Moving Average），也称为修正的简单移动平均。

#### 语法格式
```javascript
F.sma(list, period, attr?)
```

#### 特点说明
- **更平滑**: 比EMA更平滑，减少噪音
- **适中敏感度**: 介于MA和EMA之间
- **趋势跟踪**: 适合识别中长期趋势

## 📊 核心技术指标

### F.macd() - MACD指标

计算MACD（Moving Average Convergence Divergence）指标，包含DIF、DEA和MACD柱状图。

#### 语法格式
```javascript
F.macd(list, fast, slow, signal)
```

#### 参数详解
| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| `list` | array | ✅ | K线数据数组 |
| `fast` | number | ✅ | 快线周期（建议12） |
| `slow` | number | ✅ | 慢线周期（建议26） |  
| `signal` | number | ✅ | 信号线周期（建议9） |

#### 返回值结构
返回对象数组，每个对象包含：
```javascript
{
    dif: number,    // DIF值（快线-慢线）
    dea: number,    // DEA值（DIF的信号线）
    macd: number    // MACD值（DIF-DEA）
}
```

#### 完整示例
```javascript
//@name=MACD专业版
//@position=vice
//@version=1

// 参数设置
fastPeriod = I.int(12, '快线周期', 1, 50)
slowPeriod = I.int(26, '慢线周期', 1, 100)
signalPeriod = I.int(9, 'DEA周期', 1, 50)

// 样式定义
difStyle = S.line('#FF9900', 1, 'solid', title='DIF线')
deaStyle = S.line('#0066CC', 1, 'solid', title='DEA线')
zeroStyle = S.line('#999999', 1, 'solid', title='零轴线')

// MACD柱状图样式
macdBullUp = S.bar('#00C851', 'stroke', title='多头增强')
macdBullDown = S.bar('#00C851', 'fill', title='多头减弱')
macdBearUp = S.bar('#FF4444', 'stroke', title='空头减弱')  
macdBearDown = S.bar('#FF4444', 'fill', title='空头增强')

// 计算MACD
macdResult = F.macd(dataList, fastPeriod, slowPeriod, signalPeriod)
difData = F.attr(macdResult, 'dif')
deaData = F.attr(macdResult, 'dea')
macdData = F.attr(macdResult, 'macd')

// 绘制零轴线
D.hline(0, zeroStyle)

// 动态柱状图绘制
D.bar(macdData, 0, ({value, prev}) => {
    if (value >= 0) {
        // 多头区域
        return value >= prev ? macdBullUp : macdBullDown
    } else {
        // 空头区域  
        return value >= prev ? macdBearUp : macdBearDown
    }
})

// 绘制DIF和DEA线
D.line(difData, difStyle)
D.line(deaData, deaStyle)

// 信号计算
buySignals = F.throughUp(difData, deaData)
sellSignals = F.throughDown(difData, deaData)

// 输出设置
setPrecision(4)
O.tools('DIF', difData, difStyle)
O.tools('DEA', deaData, deaStyle)
O.tools('MACD', macdData, {color: '#666666'})
```

### F.rsi() - 相对强弱指数

计算RSI（Relative Strength Index）指标，衡量价格变动的速度和强度。

#### 语法格式
```javascript
F.rsi(list, period)
```

#### 参数详解
| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| `list` | array | ✅ | K线数据数组 |
| `period` | number | ✅ | 计算周期（建议14） |

#### 返回值
返回数组，数值范围0-100，不足周期的位置返回null。

#### 应用指导
- **超买区域**: RSI > 70，考虑卖出
- **超卖区域**: RSI < 30，考虑买入
- **中性区域**: 30-70，观望或趋势跟踪

#### 完整示例
```javascript
//@name=RSI指标系统
//@position=vice
//@version=1

// 参数定义
rsiPeriod = I.int(14, 'RSI周期', 1, 50)
overbought = I.int(70, '超买线', 50, 100)
oversold = I.int(30, '超卖线', 0, 50)
showSignals = I.bool(true, '显示信号')

// 样式定义
rsiStyle = S.line('#FF6D00', 2, 'solid', title='RSI线')
obStyle = S.line('#FF4444', 1, 'dashed', title='超买线')
osStyle = S.line('#4CAF50', 1, 'dashed', title='超卖线')
centerStyle = S.line('#999999', 1, 'dotted', title='中线')

// 信号样式
buySignalStyle = S.shape('arrowUp', '#4CAF50', 12, 'value', title='买入信号')
sellSignalStyle = S.shape('arrowDown', '#FF4444', 12, 'value', title='卖出信号')

// 计算RSI
rsiData = F.rsi(dataList, rsiPeriod)

// 信号计算
buySignals = F.throughUp(rsiData, oversold)    // RSI从超卖区上穿
sellSignals = F.throughDown(rsiData, overbought) // RSI从超买区下穿

// 绘制水平线
D.hline(overbought, obStyle)
D.hline(50, centerStyle)  
D.hline(oversold, osStyle)

// 绘制RSI线
D.line(rsiData, rsiStyle)

// 绘制信号
if (showSignals) {
    D.shape(buySignals, buySignalStyle)
    D.shape(sellSignals, sellSignalStyle)
}

// 副图设置
setMax(100)
setMin(0)
setPrecision(2)

// 输出
O.tools('RSI' + rsiPeriod, rsiData, rsiStyle)
```

### F.boll() - 布林带

计算Bollinger Bands，包含中轨、上轨和下轨。

#### 语法格式
```javascript
F.boll(list, period, multiplier)
```

#### 参数详解
| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| `list` | array | ✅ | K线数据数组 |
| `period` | number | ✅ | 计算周期（建议20） |
| `multiplier` | number | ✅ | 标准差倍数（建议2） |

#### 返回值结构
```javascript
{
    mid: number,    // 中轨（移动平均）
    ub: number,     // 上轨（中轨+标准差*倍数）
    lb: number      // 下轨（中轨-标准差*倍数）
}
```

#### 完整示例
```javascript
//@name=布林带系统
//@position=main
//@version=1

// 参数定义
bollPeriod = I.int(20, '布林周期', 5, 100)
bollMultiplier = I.float(2.0, '标准差倍数', 0.5, 5.0, 0.1)
showFill = I.bool(true, '显示填充')

// 样式定义
midStyle = S.line('#FFB300', 2, 'solid', title='中轨')
upperStyle = S.line('#E91E63', 1, 'solid', title='上轨')
lowerStyle = S.line('#E91E63', 1, 'solid', title='下轨')
fillStyle = S.area('rgba(233, 30, 99, 0.1)', showFill, title='通道填充')

// 计算布林带
bollResult = F.boll(dataList, bollPeriod, bollMultiplier)
midData = F.attr(bollResult, 'mid')
upperData = F.attr(bollResult, 'ub')
lowerData = F.attr(bollResult, 'lb')

// 绘制填充区域（如果启用）
if (showFill) {
    D.area(upperData, lowerData, fillStyle)
}

// 绘制布林带线条
D.line(upperData, upperStyle)
D.line(midData, midStyle)
D.line(lowerData, lowerStyle)

// 信号计算（可选）
// 价格突破上轨 = 强势信号
// 价格跌破下轨 = 弱势信号
closeData = F.attr(dataList, 'close')
upperBreak = F.throughUp(closeData, upperData)
lowerBreak = F.throughDown(closeData, lowerData)

// 输出设置
setPrecision('price')
O.tools('BOLL上轨', upperData, upperStyle)
O.tools('BOLL中轨', midData, midStyle)
O.tools('BOLL下轨', lowerData, lowerStyle)
```

## 📊 信号分析方法

### F.cross() - 交叉检测

检测两条线的交叉情况，返回交叉点信息。

#### 语法格式
```javascript
F.cross(list1, list2, attr?)
```

#### 参数详解
| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| `list1` | array | ✅ | 第一条线数据 |
| `list2` | array/number | ✅ | 第二条线数据或固定值 |
| `attr` | string | ❌ | 属性名称 |

#### 返回值结构
交叉时返回：
```javascript
{
    val1: number,      // 第一条线的值
    val2: number,      // 第二条线的值
    type: string       // 'up'(上穿) 或 'down'(下穿)
}
```
无交叉时返回null。

### F.throughUp() - 上穿检测

检测第一条线上穿第二条线的情况。

#### 语法格式
```javascript
F.throughUp(list1, list2, attr?)
```

#### 返回值
上穿时返回 `{val1, val2}`，否则返回null。

### F.throughDown() - 下穿检测

检测第一条线下穿第二条线的情况。

#### 语法格式
```javascript
F.throughDown(list1, list2, attr?)
```

#### 信号检测示例
```javascript
//@name=MA交叉信号系统
//@position=main
//@version=1

// 参数定义
fastPeriod = I.int(5, '快线周期')
slowPeriod = I.int(20, '慢线周期')
signalThreshold = I.int(50, '信号阈值')

// 计算均线
fastMA = F.ma(dataList, fastPeriod, 'close')
slowMA = F.ma(dataList, slowPeriod, 'close')

// 信号检测
crossSignals = F.cross(fastMA, slowMA)           // 所有交叉
buySignals = F.throughUp(fastMA, slowMA)         // 金叉信号
sellSignals = F.throughDown(fastMA, slowMA)      // 死叉信号

// 价格突破检测  
closeData = F.attr(dataList, 'close')
priceBreakUp = F.throughUp(closeData, signalThreshold)
priceBreakDown = F.throughDown(closeData, signalThreshold)

// 样式和绘制
fastStyle = S.line('#FF0000', 2, 'solid', title='快线')
slowStyle = S.line('#0000FF', 2, 'solid', title='慢线')
buyStyle = S.shape('arrowUp', '#00FF00', 12, 'lowDown', title='买入')
sellStyle = S.shape('arrowDown', '#FF0000', 12, 'highUp', title='卖出')

D.line(fastMA, fastStyle)
D.line(slowMA, slowStyle)
D.shape(buySignals, buyStyle)
D.shape(sellSignals, sellStyle)

// 信号统计输出
O.print('金叉信号数量: ' + buySignals.filter(s => s !== null).length)
O.print('死叉信号数量: ' + sellSignals.filter(s => s !== null).length)
```

## 🧮 F.call() - 动态方法调用

按方法名字符串动态调用F方法，实现灵活的算法切换。

### 语法格式
```javascript
F.call(methodName, ...args)
```

### 参数说明
| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| `methodName` | string | ✅ | 方法名（大小写不敏感） |
| `...args` | any | ✅ | 对应方法的参数 |

### 支持的方法名
所有F方法都支持动态调用，例如：
- `'ma'`, `'ema'`, `'sma'`, `'wma'`, `'rma'`
- `'rsi'`, `'macd'`, `'boll'`, `'kdj'`
- `'atr'`, `'tr'`, `'std'`
- 等等...

### 实用示例
```javascript
//@name=通用指标系统
//@position=main
//@version=1

// 用户可选的算法类型
maType = I.select('EMA', ['MA', 'EMA', 'SMA', 'WMA', 'RMA'], '均线类型')
period = I.int(20, '周期', 1, 200)
source = I.select('close', SOURCE, '数据源')

// 动态调用对应的F方法
maResult = F.call(maType, dataList, period, source)

// 样式和绘制
maStyle = S.line('#FF6600', 2, 'solid', title=maType + '线')
D.line(maResult, maStyle)

// 多指标动态切换示例
oscType = I.select('RSI', ['RSI', 'CCI', 'MTM'], '振荡指标')
oscPeriod = I.int(14, '振荡指标周期')

let oscResult;
switch(oscType) {
    case 'RSI':
        oscResult = F.call('rsi', dataList, oscPeriod);
        break;
    case 'CCI':
        oscResult = F.call('cci', dataList, oscPeriod);
        break;
    case 'MTM':
        oscResult = F.call('mtm', dataList, oscPeriod, 'close');
        break;
}

// 输出
O.tools(maType + period, maResult, maStyle)
```

## 💡 使用最佳实践

### 1. 参数顺序规范
```javascript
// ✅ 正确：严格按文档顺序
ma = F.ma(dataList, 20, 'close')          // list, period, attr
rsi = F.rsi(dataList, 14)                 // list, period
macd = F.macd(dataList, 12, 26, 9)        // list, fast, slow, signal

// ❌ 错误：参数顺序错误
ma = F.ma(20, dataList, 'close')          // 错误！
rsi = F.rsi(14, dataList)                 // 错误！
```

### 2. 数据类型检查
```javascript
// ✅ 正确：确保数据类型正确
if (dataList && dataList.length > 0) {
    ma = F.ma(dataList, 20, 'close')      // K线数据数组
    rsi = F.rsi(dataList, 14)             // K线数据数组
}

// ❌ 错误：传入错误数据类型
prices = [100, 101, 102]                 
rsi = F.rsi(prices, 14)                   // 错误！RSI需要K线数据
```

### 3. 返回值null处理
```javascript
// ✅ 正确：处理null返回值
ma = F.ma(dataList, 20, 'close')
maFiltered = ma.filter(val => val !== null)  // 过滤null值

// 检查有效数据数量
O.print('有效MA数据点: ' + maFiltered.length)

// ✅ 正确：在使用前检查
ma.forEach((val, index) => {
    if (val !== null && val > dataList[index].close) {
        // 处理MA大于收盘价的情况
    }
})
```

### 4. 性能优化建议
```javascript
// ✅ 推荐：复用计算结果
ma20 = F.ma(dataList, 20, 'close')
// 多次使用ma20，而不是重复计算

// ✅ 推荐：合理的周期设置  
ma_short = F.ma(dataList, 5, 'close')     // 短期
ma_medium = F.ma(dataList, 20, 'close')   // 中期
ma_long = F.ma(dataList, 60, 'close')     // 长期

// ❌ 避免：过度计算
for (let i = 1; i <= 100; i++) {
    ma = F.ma(dataList, i, 'close')       // 避免大量计算
}
```

## 🚨 常见错误和解决方案

### 错误1：参数顺序错误
```javascript
// ❌ 错误
ma = F.ma(20, dataList, 'close')

// ✅ 正确
ma = F.ma(dataList, 20, 'close')
```

### 错误2：数据类型不匹配
```javascript
// ❌ 错误：传入数值数组给需要K线数据的方法
prices = [100, 101, 102]
rsi = F.rsi(prices, 14)                    // 错误！

// ✅ 正确：传入K线数据
rsi = F.rsi(dataList, 14)                  // 正确！
```

### 错误3：忽略返回的null值
```javascript
// ❌ 错误：直接使用可能含null的数据
ma = F.ma(dataList, 20, 'close')
max = Math.max(...ma)                      // 可能出错！

// ✅ 正确：过滤null值
ma = F.ma(dataList, 20, 'close')
validMA = ma.filter(v => v !== null)
max = Math.max(...validMA)                 // 安全！
```

### 错误4：F.call方法名错误
```javascript
// ❌ 错误：方法名不存在
result = F.call('invalidMethod', dataList, 20)

// ✅ 正确：使用正确的方法名
result = F.call('ma', dataList, 20, 'close')
result = F.call('ema', dataList, 20, 'close')
```

## 🌊 波动率分析方法

### F.atr() - 平均真实波幅

计算ATR（Average True Range）指标，衡量市场波动性。

#### 语法格式
```javascript
F.atr(list, period)
```

#### 参数详解
| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| `list` | array | ✅ | K线数据数组 |
| `period` | number | ✅ | 计算周期（建议14） |

#### 返回值
返回数组，ATR值，不足周期的位置返回null。

#### 完整示例
```javascript
//@name=ATR止损系统
//@position=main
//@version=1

// 参数定义
atrPeriod = I.int(14, 'ATR周期', 1, 50)
atrMultiplier = I.float(2.0, 'ATR倍数', 0.5, 5.0, 0.1)

// 样式定义
stopLossStyle = S.line('#FF4444', 2, 'dashed', title='止损线')
takeProfitStyle = S.line('#00FF00', 2, 'dashed', title='止盈线')

// 计算ATR
atr = F.atr(dataList, atrPeriod)
closeData = F.attr(dataList, 'close')

// 计算止损止盈线
stopLoss = closeData.map((close, index) => {
    if (atr[index] !== null) {
        return close - (atr[index] * atrMultiplier)
    }
    return null
})

takeProfit = closeData.map((close, index) => {
    if (atr[index] !== null) {
        return close + (atr[index] * atrMultiplier)
    }
    return null
})

// 绘制
D.line(stopLoss, stopLossStyle)
D.line(takeProfit, takeProfitStyle)

// 输出
setPrecision('price')
O.tools('止损线', stopLoss, stopLossStyle)
O.tools('止盈线', takeProfit, takeProfitStyle)
```

## 📈 价量分析方法

### F.obv() - 能量潮指标

计算OBV（On-Balance Volume）指标，分析价格和成交量的关系。

#### 语法格式
```javascript
F.obv(list)
```

#### 参数详解
| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| `list` | array | ✅ | K线数据数组 |

#### 返回值
返回数组，OBV累积值。

#### 完整示例
```javascript
//@name=OBV量价分析
//@position=vice
//@version=1

// 样式定义
obvStyle = S.line('#9C27B0', 2, 'solid', title='OBV线')
obvMaStyle = S.line('#FF9800', 1, 'solid', title='OBV均线')

// 计算OBV
obv = F.obv(dataList)
obvMa = F.ma(obv, 20)

// 信号分析
obvSignals = F.cross(obv, obvMa)

// 绘制
D.line(obv, obvStyle)
D.line(obvMa, obvMaStyle)

// 输出
setPrecision(0)
O.tools('OBV', obv, obvStyle)
O.tools('OBV MA20', obvMa, obvMaStyle)
```

## 📊 统计分析方法

### F.hhv() - 最高值

获取指定周期内的最高值。

#### 语法格式
```javascript
F.hhv(list, period, attr?)
```

#### 参数详解
| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| `list` | array | ✅ | K线数据数组或数值数组 |
| `period` | number | ✅ | 回看周期 |
| `attr` | string | ❌ | 属性名称 |

#### 示例
```javascript
// 获取20周期内最高价
highestHigh = F.hhv(dataList, 20, 'high')

// 获取数值数组中的最高值
prices = [100, 105, 98, 112, 95]
maxPrice = F.hhv(prices, 5)
```

### F.llv() - 最低值

获取指定周期内的最低值。

#### 语法格式
```javascript
F.llv(list, period, attr?)
```

#### 示例应用 - 唐奇安通道
```javascript
//@name=唐奇安通道
//@position=main
//@version=1

// 参数定义
period = I.int(20, '通道周期', 1, 100)

// 样式定义
upperStyle = S.line('#00FF00', 1, 'solid', title='上轨')
lowerStyle = S.line('#FF0000', 1, 'solid', title='下轨')
fillStyle = S.area('rgba(0, 255, 0, 0.1)', title='通道填充')

// 计算唐奇安通道
upperBand = F.hhv(dataList, period, 'high')
lowerBand = F.llv(dataList, period, 'low')

// 绘制
D.area(upperBand, lowerBand, fillStyle)
D.line(upperBand, upperStyle)
D.line(lowerBand, lowerStyle)

// 突破信号
closeData = F.attr(dataList, 'close')
breakoutUp = F.throughUp(closeData, upperBand)
breakoutDown = F.throughDown(closeData, lowerBand)

// 输出
setPrecision('price')
O.tools('上轨', upperBand, upperStyle)
O.tools('下轨', lowerBand, lowerStyle)
```

## 🚀 高级应用实例

### 多时间框架RSI
```javascript
//@name=多时间框架RSI
//@position=vice
//@version=1

// 参数定义
rsiPeriod = I.int(14, 'RSI周期')
showMultiTimeframe = I.bool(true, '显示多时间框架')

// 样式定义
rsiStyle = S.line('#E91E63', 2, 'solid', title='RSI')
rsiMa = S.line('#2196F3', 1, 'solid', title='RSI均线')

// 计算RSI
rsi = F.rsi(dataList, rsiPeriod)
rsiSmooth = F.ma(rsi, 5)

// 多重验证信号
rsiOverbought = rsi.map(val => val > 70 ? val : null)
rsiOversold = rsi.map(val => val < 30 ? val : null)

// 背离检测（简化版）
priceHigh = F.hhv(dataList, 14, 'high')
rsiHigh = F.hhv(rsi, 14)

// 绘制
D.line(rsi, rsiStyle)
D.line(rsiSmooth, rsiMa)
D.hline(70, S.line('#FF0000', 1, 'dashed'))
D.hline(30, S.line('#00FF00', 1, 'dashed'))
D.hline(50, S.line('#999999', 1, 'dotted'))

// 设置副图
setMax(100)
setMin(0)
setPrecision(2)

// 输出
O.tools('RSI', rsi, rsiStyle)
O.tools('RSI平滑', rsiSmooth, rsiMa)
```

## 🔗 相关内容

- **数据处理**: [基础概念](02-基础概念和脚本结构.md#数据类型系统) - 了解数据类型
- **绘图应用**: [D方法详解](06-绘图输出方法(D方法).md) - 将F方法结果绘制成图
- **参数配置**: [I方法详解](03-输入参数方法(I方法).md) - F方法参数的用户化设置
- **实际案例**: [脚本案例库](09-完整脚本案例库.md) - F方法在实际指标中的应用
- **错误处理**: [错误处理指南](10-错误处理和调试指南.md) - F方法常见错误解决

---
**提示**: F方法是GainLab Script的核心，共64个计算函数覆盖技术分析的各个方面。熟练掌握常用F方法是开发高质量指标的基础。建议从基础方法开始，逐步掌握更复杂的技术指标方法。