# I方法 - 输入参数定义

## 📋 I方法概述

**I方法（Input Method）**用于定义脚本的输入参数，在图表设置面板中显示供用户动态调整，实现参数化的指标脚本。

### 🎯 核心特点
- 📊 **动态参数** - 用户可在设置面板中调整参数
- 🔄 **实时更新** - 参数变更后指标自动重新计算
- 🎨 **分组显示** - 支持参数分组便于管理
- 💡 **类型丰富** - 支持整数、浮点数、布尔值、选择框

### ⚠️ 核心约束
- **🚫 禁止使用变量**: I方法中所有参数必须是常量
- **🚫 禁止动态调用**: 不能在循环或条件语句中使用
- **✅ 必须在脚本开头**: I方法调用必须在计算逻辑之前

## 🔧 I方法完整列表

| 方法 | 用途 | 返回类型 | 使用频率 |
|------|------|---------|---------|
| [I.int()](#I.int) | 整数输入 | number | 🔥 极高 |
| [I.float()](#I.float) | 浮点数输入 | number | 🔥 极高 |
| [I.bool()](#I.bool) | 布尔值输入 | boolean | 📊 高 |
| [I.select()](#I.select) | 下拉选择输入 | string | 📊 高 |

## 📐 I.int() - 整数输入

定义**整数类型**的可设置参数，适用于周期、数量等整数值参数。

### 语法格式
```javascript
val = I.int(defaultValue, title?, min?, max?, tip?)
```

### 参数详解

| 参数 | 类型 | 必填 | 默认值 | 说明 | 示例 |
|------|------|------|--------|------|------|
| `defaultValue` | number | ✅ | - | 默认整数值 | `14`, `20`, `100` |
| `title` | string | ❌ | 变量名 | 显示名称 | `'周期'`, `'长度'` |
| `min` | number | ❌ | -∞ | 最小值限制 | `1`, `0`, `-100` |
| `max` | number | ❌ | +∞ | 最大值限制 | `500`, `100`, `200` |
| `tip` | string | ❌ | - | 提示说明 | `'MA计算周期'` |

### 基础示例
```javascript
// 简单用法
const period = I.int(14, '周期');
const length = I.int(20);  // 不指定title，显示变量名"length"

// 完整参数用法
const period = I.int(20, title='长度', min=5, max=100, tip='MA计算周期');
```

### 进阶示例
```javascript
//@name=多周期MA
//@position=main
//@version=1

// 基础参数组
period1 = I.int(5, title='短周期', min=1, max=50, tip='短期MA计算周期')
period2 = I.int(20, title='中周期', min=1, max=100, tip='中期MA计算周期')
period3 = I.int(60, title='长周期', min=1, max=200, tip='长期MA计算周期')

// 高级参数组
signalPeriod = I.int(9, title='信号周期', min=1, max=50, tip='信号线计算周期')
lookback = I.int(100, title='回看周期', min=10, max=500, tip='信号验证回看长度')

// 样式定义和计算...
```

### 常见错误示例
```javascript
// ❌ 错误：使用变量作为默认值
let defaultPeriod = 14;
const period = I.int(defaultPeriod, '周期');  // 报错！

// ❌ 错误：使用计算结果
const period = I.int(10 + 4, '周期');          // 报错！

// ❌ 错误：在条件中使用
if (someCondition) {
    period = I.int(14, '周期');                // 报错！
}

// ✅ 正确：使用常量
const period = I.int(14, '周期');              // 正确！
```

## 📊 I.float() - 浮点数输入

定义**浮点数类型**的可设置参数，适用于比例、倍数等小数值参数。

### 语法格式
```javascript
val = I.float(defaultValue, title?, min?, max?, tip?)
```

### 参数详解

| 参数 | 类型 | 必填 | 默认值 | 说明 | 示例 |
|------|------|------|--------|------|------|
| `defaultValue` | number | ✅ | - | 默认浮点数值 | `0.5`, `2.0`, `1.618` |
| `title` | string | ❌ | 变量名 | 显示名称 | `'系数'`, `'倍数'` |
| `min` | number | ❌ | -∞ | 最小值 | `0`, `-1.0`, `0.1` |
| `max` | number | ❌ | +∞ | 最大值 | `5.0`, `10.0`, `100` |
| `tip` | string | ❌ | - | 提示说明 | `'ATR倍数'` |

### 基础示例
```javascript
// 简单用法
const multiplier = I.float(2.0, '倍数');
const ratio = I.float(0.618, '黄金比例');

// 完整参数用法
const atrMultiplier = I.float(2.0, title='ATR倍数', min=0.1, max=10.0, tip='ATR计算倍数');
```

### 实用示例 - SuperTrend指标
```javascript
//@name=SuperTrend
//@position=main
//@version=1

// 浮点数参数定义
multiplier = I.float(3.0, title='ATR倍数', min=0.1, max=10.0, tip='ATR倍数设置')
smoothing = I.float(0.1, title='平滑系数', min=0.01, max=1.0, tip='SuperTrend平滑系数')

// 整数参数
length = I.int(10, title='ATR长度', min=1, max=50, tip='ATR计算周期')

// 后续计算逻辑...
atr = F.atr(dataList, length)
// ...
```

## 🔘 I.bool() - 布尔值输入

定义**布尔类型**的可设置参数，在设置面板中显示为开关控件。

### 语法格式
```javascript
val = I.bool(defaultValue, title?, tip?)
```

### 参数详解

| 参数 | 类型 | 必填 | 默认值 | 说明 | 示例 |
|------|------|------|--------|------|------|
| `defaultValue` | boolean | ✅ | - | 默认布尔值 | `true`, `false` |
| `title` | string | ❌ | 变量名 | 显示名称 | `'显示信号'`, `'启用过滤'` |
| `tip` | string | ❌ | - | 提示说明 | `'是否显示买卖信号'` |

### 基础示例
```javascript
// 简单用法
const showSignals = I.bool(true, '显示信号');
const enableFilter = I.bool(false, '启用过滤');

// 带提示说明
const smoothing = I.bool(true, '平滑处理', '是否对数据进行平滑处理');
```

### 实用示例 - 多功能MA指标
```javascript
//@name=多功能MA
//@position=main
//@version=1

// 基础参数
period = I.int(20, '周期', 1, 200)
source = I.select('close', '数据源', options=SOURCE)

// 功能开关
showMA = I.bool(true, '显示MA线', '是否显示移动平均线')
showSignals = I.bool(false, '显示信号', '是否显示买卖信号')
showFill = I.bool(false, '显示填充', '是否显示价格与MA间的填充区域')
enableAlert = I.bool(true, '启用提醒', '价格穿越MA时是否提醒')

// 样式定义
maStyle = S.line('#FF6600', 2, 'solid', showMA, '主线样式')

// 计算逻辑
ma = F.ma(dataList, period, source)

// 条件绘制
if (showMA) {
    D.line(ma, maStyle);
}

if (showSignals) {
    // 绘制信号...
}

if (showFill) {
    // 绘制填充...
}
```

## 📋 I.select() - 下拉选择输入

定义**下拉选择**类型的参数，用户可从预定义选项中选择。

### 语法格式
```javascript
val = I.select(defaultValue, options, title?, tip?)
```

### 参数详解

| 参数 | 类型 | 必填 | 默认值 | 说明 | 示例 |
|------|------|------|--------|------|------|
| `defaultValue` | string | ✅ | - | 默认选中值（必须在options中） | `'close'`, `'EMA'` |
| `options` | array | ✅ | - | 可选项数组或SOURCE常量 | `['MA','EMA']`, `SOURCE` |
| `title` | string | ❌ | 变量名 | 显示名称 | `'数据源'`, `'算法'` |
| `tip` | string | ❌ | - | 提示说明 | `'选择计算用的数据'` |

### 基础示例
```javascript
// 使用SOURCE常量（推荐）
const source = I.select('close', options=SOURCE, title='数据源', tip='选择计算数据源');

// 自定义选项
const maType = I.select('EMA', options=['MA', 'EMA', 'SMA', 'WMA'], title='算法', tip='选择移动平均算法');
const timeframe = I.select('1h', options=['1m', '5m', '15m', '1h', '4h', '1d'], title='时间框架');
```

### 实用示例 - 通用MA指标
```javascript
//@name=通用MA
//@position=main
//@version=1

// 参数定义
period = I.int(20, title='周期', min=1, max=200, tip='MA计算周期')
source = I.select('close', options=SOURCE, title='数据源', tip='用于计算的数据源')
maType = I.select('EMA', options=['MA', 'EMA', 'SMA', 'WMA', 'RMA', 'DEMA', 'TEMA'], 
                  title='MA类型', tip='选择移动平均算法')

// 高级参数  
showType = I.select('line', options=['line', 'step'], title='显示方式', tip='选择线条显示方式')
colorMode = I.select('single', options=['single', 'trend'], title='颜色模式', tip='单色或趋势色')

// 样式定义
maStyle = S.line('#FF6600', 2, showType === 'line' ? 'solid' : 'step', '主线')

// 动态计算不同类型的MA
let ma;
switch(maType) {
    case 'MA':
        ma = F.ma(dataList, period, source);
        break;
    case 'EMA':
        ma = F.ema(dataList, period, source);
        break;
    case 'SMA':
        ma = F.sma(dataList, period, source);
        break;
    // ... 其他类型
    default:
        ma = F.ma(dataList, period, source);
}

// 动态样式绘制
if (colorMode === 'trend') {
    D.line(ma, ({value, prev}) => {
        return value > prev ? S.line('#00FF00', 2) : S.line('#FF0000', 2);
    });
} else {
    D.line(ma, maStyle);
}
```

## 💡 使用最佳实践

### 1. 参数命名策略
```javascript
// ✅ 良好的参数命名
// 基础参数
period1 = I.int(5, title='短周期', min=1, max=50)
period2 = I.int(20, title='长周期', min=1, max=200)
source = I.select('close', options=SOURCE, title='数据源')

// 高级参数
smoothing = I.float(0.1, title='平滑系数', min=0.01, max=1.0)
lookback = I.int(100, title='回看周期', min=10, max=500)

// 显示控制
showSignals = I.bool(true, title='显示信号')
showLabels = I.bool(false, title='显示标签')
```

### 2. 合理的参数范围
```javascript
// ✅ 合理的参数范围设计
period = I.int(20, title='周期', min=1, max=200)        // 1-200是合理的MA周期范围
multiplier = I.float(2.0, title='倍数', min=0.1, max=10.0)  // 0.1-10.0是合理的倍数范围
threshold = I.float(70, title='阈值', min=0, max=100)    // 0-100适合百分比阈值

// ❌ 不合理的参数范围
period = I.int(20, title='周期', min=1, max=10000)      // 太大的范围没有意义
multiplier = I.float(2.0, title='倍数', min=-100, max=100) // 负数倍数通常没意义
```

### 3. 清晰的参数命名
```javascript
// ✅ 清晰的命名
fastPeriod = I.int(12, title='快线周期', min=1, max=50)
slowPeriod = I.int(26, title='慢线周期', min=1, max=200)
signalPeriod = I.int(9, title='信号周期', min=1, max=50)

// ❌ 不清晰的命名
n1 = I.int(12, title='N1')
n2 = I.int(26, title='N2')
p = I.int(9, title='P')
```

### 4. 有用的提示信息
```javascript
// ✅ 有帮助的提示
period = I.int(14, title='RSI周期', min=1, max=50, 
              tip='RSI计算周期，建议14-21，值越小越敏感')
overbought = I.float(70, title='超买阈值', min=50, max=100,
                    tip='超买阈值，通常70-80，值越低信号越频繁')

// ❌ 无用的提示
period = I.int(14, title='RSI周期', min=1, max=50, tip='RSI周期参数')  // 重复说明
```

## 🚨 常见错误和解决方案

### 错误1：在I方法中使用变量
```javascript
// ❌ 错误代码
let defaultPeriod = 20;
period = I.int(defaultPeriod, '周期');  // 报错！

// ✅ 正确代码
period = I.int(20, '周期');  // 使用常量
```

### 错误2：参数顺序错误
```javascript
// ❌ 错误：title和options顺序颠倒
source = I.select('close', title='数据源', options=SOURCE);  // 参数名写法

// ✅ 正确：按位置传参
source = I.select('close', SOURCE, '数据源');
```

### 错误3：defaultValue不在options中
```javascript
// ❌ 错误：'CLOSE'不在选项中（大小写敏感）
source = I.select('CLOSE', SOURCE, '数据源');  // 会使用第一个选项

// ✅ 正确：确保defaultValue在options中
source = I.select('close', SOURCE, '数据源');  // 'close'在SOURCE中
```

### 错误4：在循环中使用I方法
```javascript
// ❌ 错误：在循环中定义参数
for (let i = 1; i <= 3; i++) {
    let period = I.int(i * 10, `周期${i}`);  // 报错！
}

// ✅ 正确：在脚本开头定义
period1 = I.int(10, '周期1');
period2 = I.int(20, '周期2');
period3 = I.int(30, '周期3');
```

## 🔗 相关内容

- **下一步学习**: [S方法详解](04-样式设置方法(S方法).md) - 学习样式设置
- **计算应用**: [F方法详解](05-计算函数方法(F方法).md) - 在计算中使用参数
- **约束详情**: [重要规则汇总](01-重要规则汇总.md#I方法限制) - 查看完整约束说明
- **实际案例**: [脚本案例库](09-完整脚本案例库.md) - 查看I方法在实际指标中的使用
- **错误处理**: [错误处理指南](10-错误处理和调试指南.md#I方法错误) - I方法常见错误解决

---
**提示**: I方法是实现用户交互的关键，合理设计参数能大大提升指标的灵活性和用户体验。