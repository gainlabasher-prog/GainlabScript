# Uæ–¹æ³• - å·¥å…·å‡½æ•°

## ğŸ“‹ Uæ–¹æ³•æ¦‚è¿°

**Uæ–¹æ³•ï¼ˆUtil Methodï¼‰**æä¾›26ä¸ªå®ç”¨å·¥å…·å‡½æ•°ï¼Œæ¶µç›–æ•°æ®éªŒè¯ã€æ•°å­¦è®¡ç®—ã€æ•°ç»„å¤„ç†ã€æ—¶é—´å¤„ç†ç­‰å¸¸ç”¨åŠŸèƒ½ï¼Œæ˜¯GainLab Scriptå¼€å‘çš„å¾—åŠ›åŠ©æ‰‹ï¼Œæå‡ä»£ç è´¨é‡å’Œå¼€å‘æ•ˆç‡ã€‚

### ğŸ¯ æ ¸å¿ƒç‰¹ç‚¹
- ğŸ” **æ•°æ®éªŒè¯** - æä¾›å…¨é¢çš„æ•°æ®ç±»å‹å’Œæœ‰æ•ˆæ€§æ£€æŸ¥
- ğŸ§® **æ•°å­¦è®¡ç®—** - å¸¸ç”¨æ•°å­¦è¿ç®—å‡½æ•°ï¼Œå¤„ç†æ•°å€¼è®¡ç®—
- ğŸ“Š **æ•°ç»„å¤„ç†** - æ•°ç»„æ“ä½œå·¥å…·ï¼Œç®€åŒ–æ•°æ®å¤„ç†æµç¨‹
- â° **æ—¶é—´å¤„ç†** - æ—¶é—´æ ¼å¼åŒ–å’Œè½¬æ¢å·¥å…·

### âš ï¸ æ ¸å¿ƒçº¦æŸ
- **âœ… çº¯å‡½æ•°è®¾è®¡** - ä¸ä¿®æ”¹åŸå§‹æ•°æ®ï¼Œè¿”å›æ–°ç»“æœ
- **âœ… å¼‚å¸¸å®‰å…¨** - è‡ªåŠ¨å¤„ç†nullã€undefinedç­‰å¼‚å¸¸æƒ…å†µ
- **âœ… æ€§èƒ½ä¼˜åŒ–** - é’ˆå¯¹å¤§æ•°æ®é‡è¿›è¡Œä¼˜åŒ–
- **âœ… ç±»å‹å…¼å®¹** - æ”¯æŒå¤šç§æ•°æ®ç±»å‹è¾“å…¥

## ğŸ—‚ï¸ Uæ–¹æ³•å®Œæ•´åˆ†ç±»

### ğŸ” æ•°æ®éªŒè¯ç±»ï¼ˆ8ä¸ªæ–¹æ³•ï¼‰
| æ–¹æ³• | åŠŸèƒ½ | è¿”å›ç±»å‹ | ä½¿ç”¨é¢‘ç‡ |
|------|------|---------|---------|
| [U.isValid()](#U.isValid) | æ£€æŸ¥æ•°æ®æœ‰æ•ˆæ€§ | boolean | ğŸ”¥ æé«˜ |
| [U.isValidNumber()](#U.isValidNumber) | æ£€æŸ¥æ•°å€¼æœ‰æ•ˆæ€§ | boolean | ğŸ”¥ æé«˜ |
| [U.isNull()](#U.isNull) | æ£€æŸ¥nullå€¼ | boolean | ğŸ“Š é«˜ |
| [U.isEmpty()](#U.isEmpty) | æ£€æŸ¥ç©ºå€¼ | boolean | ğŸ“Š é«˜ |
| [U.isArray()](#U.isArray) | æ£€æŸ¥æ•°ç»„ç±»å‹ | boolean | ğŸ“ ä¸­ç­‰ |
| [U.isObject()](#U.isObject) | æ£€æŸ¥å¯¹è±¡ç±»å‹ | boolean | ğŸ“ ä¸­ç­‰ |
| [U.isString()](#U.isString) | æ£€æŸ¥å­—ç¬¦ä¸²ç±»å‹ | boolean | ğŸ“ ä¸­ç­‰ |
| [U.isNumber()](#U.isNumber) | æ£€æŸ¥æ•°å€¼ç±»å‹ | boolean | ğŸ“ ä¸­ç­‰ |

### ğŸ§® æ•°å­¦è®¡ç®—ç±»ï¼ˆ8ä¸ªæ–¹æ³•ï¼‰
| æ–¹æ³• | åŠŸèƒ½ | è¿”å›ç±»å‹ | ä½¿ç”¨é¢‘ç‡ |
|------|------|---------|---------|
| [U.sum()](#U.sum) | æ•°ç»„æ±‚å’Œ | number | ğŸ”¥ æé«˜ |
| [U.avg()](#U.avg) | è®¡ç®—å¹³å‡å€¼ | number | ğŸ”¥ æé«˜ |
| [U.max()](#U.max) | è·å–æœ€å¤§å€¼ | number | ğŸ“Š é«˜ |
| [U.min()](#U.min) | è·å–æœ€å°å€¼ | number | ğŸ“Š é«˜ |
| [U.abs()](#U.abs) | è®¡ç®—ç»å¯¹å€¼ | number/array | ğŸ“Š é«˜ |
| [U.round()](#U.round) | å››èˆäº”å…¥ | number/array | ğŸ“ ä¸­ç­‰ |
| [U.floor()](#U.floor) | å‘ä¸‹å–æ•´ | number/array | ğŸ“ ä¸­ç­‰ |
| [U.ceil()](#U.ceil) | å‘ä¸Šå–æ•´ | number/array | ğŸ“ ä¸­ç­‰ |

### ğŸ“Š æ•°ç»„å¤„ç†ç±»ï¼ˆ6ä¸ªæ–¹æ³•ï¼‰
| æ–¹æ³• | åŠŸèƒ½ | è¿”å›ç±»å‹ | ä½¿ç”¨é¢‘ç‡ |
|------|------|---------|---------|
| [U.slice()](#U.slice) | æ•°ç»„åˆ‡ç‰‡ | array | ğŸ“Š é«˜ |
| [U.filter()](#U.filter) | æ•°ç»„è¿‡æ»¤ | array | ğŸ“Š é«˜ |
| [U.map()](#U.map) | æ•°ç»„æ˜ å°„ | array | ğŸ“ ä¸­ç­‰ |
| [U.forEach()](#U.forEach) | æ•°ç»„éå† | void | ğŸ“ ä¸­ç­‰ |
| [U.find()](#U.find) | æŸ¥æ‰¾å…ƒç´  | any | ğŸ“ ä¸­ç­‰ |
| [U.sort()](#U.sort) | æ•°ç»„æ’åº | array | ğŸ“ ä½ |

### â° æ—¶é—´å¤„ç†ç±»ï¼ˆ4ä¸ªæ–¹æ³•ï¼‰
| æ–¹æ³• | åŠŸèƒ½ | è¿”å›ç±»å‹ | ä½¿ç”¨é¢‘ç‡ |
|------|------|---------|---------|
| [U.formatTime()](#U.formatTime) | æ—¶é—´æ ¼å¼åŒ– | string | ğŸ“Š é«˜ |
| [U.parseTime()](#U.parseTime) | æ—¶é—´è§£æ | number | ğŸ“ ä¸­ç­‰ |
| [U.timeframe()](#U.timeframe) | æ—¶é—´å‘¨æœŸè½¬æ¢ | number | ğŸ“ ä¸­ç­‰ |
| [U.timestamp()](#U.timestamp) | æ—¶é—´æˆ³å¤„ç† | number | ğŸ“ ä¸­ç­‰ |

## ğŸ” æ•°æ®éªŒè¯æ–¹æ³•

### U.isValid() - æ•°æ®æœ‰æ•ˆæ€§æ£€æŸ¥

æ£€æŸ¥æ•°æ®æ˜¯å¦ä¸ºæœ‰æ•ˆå€¼ï¼ˆénullã€undefinedã€ç©ºå­—ç¬¦ä¸²ã€ç©ºå¯¹è±¡ï¼‰ã€‚

#### è¯­æ³•æ ¼å¼
```javascript
U.isValid(value)
```

#### å‚æ•°è¯¦è§£
| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| `value` | any | âœ… | å¾…æ£€æŸ¥çš„å€¼ |

#### è¿”å›å€¼
è¿”å›booleanï¼Œtrueè¡¨ç¤ºæœ‰æ•ˆï¼Œfalseè¡¨ç¤ºæ— æ•ˆã€‚

#### åŸºç¡€ç¤ºä¾‹
```javascript
//@name=æ•°æ®éªŒè¯ç¤ºä¾‹
//@position=main
//@version=1

// åŸºç¡€éªŒè¯
O.print('æœ‰æ•ˆæ•°å­—: ' + U.isValid(123))        // true
O.print('æœ‰æ•ˆå­—ç¬¦ä¸²: ' + U.isValid('hello'))  // true
O.print('nullå€¼: ' + U.isValid(null))        // false
O.print('undefined: ' + U.isValid(undefined)) // false
O.print('ç©ºå­—ç¬¦ä¸²: ' + U.isValid(''))         // false
O.print('ç©ºæ•°ç»„: ' + U.isValid([]))           // false
O.print('ç©ºå¯¹è±¡: ' + U.isValid({}))           // false

// å®é™…åº”ç”¨
period = I.int(20, 'å‘¨æœŸ')
if (U.isValid(dataList) && dataList.length > period) {
    ma = F.ma(dataList, period, 'close')
    
    // éªŒè¯è®¡ç®—ç»“æœ
    validMA = ma.filter(val => U.isValid(val))
    O.print('æœ‰æ•ˆMAæ•°æ®ç‚¹: ' + validMA.length)
    
    if (validMA.length > 0) {
        maStyle = S.line('#FF6600', 2, 'solid')
        D.line(ma, maStyle)
        O.tools('MA' + period, ma, maStyle)
    }
} else {
    O.print('æ•°æ®ä¸è¶³ï¼Œæ— æ³•è®¡ç®—MA', 'warn')
}
```

### U.isValidNumber() - æ•°å€¼æœ‰æ•ˆæ€§æ£€æŸ¥

æ£€æŸ¥æ•°å€¼æ˜¯å¦ä¸ºæœ‰æ•ˆæ•°å­—ï¼ˆénullã€undefinedã€NaNã€Infinityï¼‰ã€‚

#### è¯­æ³•æ ¼å¼
```javascript
U.isValidNumber(value)
```

#### å®Œæ•´ç¤ºä¾‹
```javascript
//@name=æ•°å€¼éªŒè¯ä¸å¤„ç†
//@position=main
//@version=1

// å‚æ•°å®šä¹‰
threshold = I.float(100.0, 'ä»·æ ¼é˜ˆå€¼')

// è·å–å½“å‰ä»·æ ¼
currentKline = dataList[dataList.length - 1]
currentPrice = currentKline ? currentKline.close : null

// æ•°å€¼éªŒè¯
if (U.isValidNumber(currentPrice) && U.isValidNumber(threshold)) {
    O.print('å½“å‰ä»·æ ¼: ' + currentPrice.toFixed(2))
    O.print('è®¾å®šé˜ˆå€¼: ' + threshold.toFixed(2))
    
    // ä»·æ ¼æ¯”è¾ƒ
    if (currentPrice > threshold) {
        O.print('ä»·æ ¼é«˜äºé˜ˆå€¼', 'warn')
        O.notify('ä»·æ ¼çªç ´é˜ˆå€¼ï¼')
    }
    
    // è®¡ç®—å·®å€¼ï¼ˆç¡®ä¿æ˜¯æœ‰æ•ˆæ•°å­—ï¼‰
    priceDiff = currentPrice - threshold
    if (U.isValidNumber(priceDiff)) {
        O.print('ä»·æ ¼å·®å€¼: ' + priceDiff.toFixed(2))
    }
} else {
    O.print('ä»·æ ¼æ•°æ®æ— æ•ˆ', 'error')
}

// æ‰¹é‡éªŒè¯æ•°ç»„ä¸­çš„æ•°å€¼
prices = F.attr(dataList, 'close')
validPrices = prices.filter(price => U.isValidNumber(price))
O.print(`æ€»ä»·æ ¼æ•°æ®: ${prices.length}, æœ‰æ•ˆæ•°æ®: ${validPrices.length}`)
```

## ğŸ§® æ•°å­¦è®¡ç®—æ–¹æ³•

### U.sum() - æ•°ç»„æ±‚å’Œ

è®¡ç®—æ•°ç»„ä¸­æ‰€æœ‰æœ‰æ•ˆæ•°å€¼çš„æ€»å’Œã€‚

#### è¯­æ³•æ ¼å¼
```javascript
U.sum(array, skipInvalid?)
```

#### å‚æ•°è¯¦è§£
| å‚æ•° | ç±»å‹ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|------|--------|------|
| `array` | array | âœ… | - | æ•°å€¼æ•°ç»„ |
| `skipInvalid` | boolean | âŒ | `true` | æ˜¯å¦è·³è¿‡æ— æ•ˆå€¼ |

#### ç¤ºä¾‹
```javascript
//@name=æ•°å­¦è®¡ç®—å·¥å…·ç¤ºä¾‹
//@position=vice
//@version=1

// è·å–æˆäº¤é‡æ•°æ®
volumes = F.attr(dataList, 'volume')
validVolumes = volumes.filter(vol => U.isValidNumber(vol))

// è®¡ç®—æ€»æˆäº¤é‡
totalVolume = U.sum(validVolumes)
O.print('æ€»æˆäº¤é‡: ' + totalVolume.toFixed(0))

// è®¡ç®—å¹³å‡æˆäº¤é‡
avgVolume = U.avg(validVolumes)
O.print('å¹³å‡æˆäº¤é‡: ' + avgVolume.toFixed(0))

// è·å–æˆäº¤é‡ç»Ÿè®¡
maxVolume = U.max(validVolumes)
minVolume = U.min(validVolumes)
O.print('æœ€å¤§æˆäº¤é‡: ' + maxVolume.toFixed(0))
O.print('æœ€å°æˆäº¤é‡: ' + minVolume.toFixed(0))

// è®¡ç®—ä»·æ ¼æ•°æ®
prices = F.attr(dataList, 'close')
validPrices = prices.filter(price => U.isValidNumber(price))

if (validPrices.length > 0) {
    priceSum = U.sum(validPrices)
    priceAvg = U.avg(validPrices)
    
    O.print('ä»·æ ¼æ€»å’Œ: ' + priceSum.toFixed(2))
    O.print('ä»·æ ¼å¹³å‡: ' + priceAvg.toFixed(2))
}
```

### U.avg() - å¹³å‡å€¼è®¡ç®—

è®¡ç®—æ•°ç»„ä¸­æ‰€æœ‰æœ‰æ•ˆæ•°å€¼çš„å¹³å‡å€¼ã€‚

#### è¯­æ³•æ ¼å¼
```javascript
U.avg(array, skipInvalid?)
```

#### é«˜çº§ç¤ºä¾‹ - åŠ¨æ€å¹³å‡çº¿
```javascript
//@name=åŠ¨æ€å¹³å‡çº¿
//@position=main
//@version=1

// å‚æ•°å®šä¹‰
lookback = I.int(20, 'å›çœ‹å‘¨æœŸ', 5, 100)
dynamicAvg = I.bool(true, 'å¯ç”¨åŠ¨æ€å¹³å‡')

// è·å–ä»·æ ¼æ•°æ®
prices = F.attr(dataList, 'close')

// è®¡ç®—åŠ¨æ€å¹³å‡çº¿
dynamicMA = prices.map((price, index) => {
    if (!U.isValidNumber(price)) return null
    
    if (dynamicAvg) {
        // åŠ¨æ€å‘¨æœŸï¼šæ ¹æ®æ³¢åŠ¨ç‡è°ƒæ•´
        const start = Math.max(0, index - lookback)
        const recentPrices = prices.slice(start, index + 1)
        const validPrices = recentPrices.filter(p => U.isValidNumber(p))
        
        if (validPrices.length > 0) {
            return U.avg(validPrices)
        }
    } else {
        // å›ºå®šå‘¨æœŸ
        if (index >= lookback - 1) {
            const periodPrices = prices.slice(index - lookback + 1, index + 1)
            const validPrices = periodPrices.filter(p => U.isValidNumber(p))
            
            if (validPrices.length > 0) {
                return U.avg(validPrices)
            }
        }
    }
    
    return null
})

// æ ·å¼å’Œç»˜åˆ¶
maStyle = S.line('#FF6600', 2, 'solid', title='åŠ¨æ€MA')
D.line(dynamicMA, maStyle)

// è¾“å‡º
setPrecision('price')
O.tools('åŠ¨æ€MA', dynamicMA, maStyle)
```

## ğŸ“Š æ•°ç»„å¤„ç†æ–¹æ³•

### U.slice() - æ•°ç»„åˆ‡ç‰‡

ä»æ•°ç»„ä¸­æå–æŒ‡å®šèŒƒå›´çš„å…ƒç´ ã€‚

#### è¯­æ³•æ ¼å¼
```javascript
U.slice(array, start, end?)
```

#### å‚æ•°è¯¦è§£
| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| `array` | array | âœ… | æºæ•°ç»„ |
| `start` | number | âœ… | å¼€å§‹ç´¢å¼• |
| `end` | number | âŒ | ç»“æŸç´¢å¼•ï¼ˆä¸åŒ…å«ï¼‰ |

#### ç¤ºä¾‹
```javascript
//@name=æ•°æ®åˆ‡ç‰‡å¤„ç†
//@position=main
//@version=1

// å‚æ•°å®šä¹‰
analysisLength = I.int(100, 'åˆ†æé•¿åº¦', 10, 500)

// è·å–æœ€è¿‘çš„æ•°æ®è¿›è¡Œåˆ†æ
if (dataList.length > analysisLength) {
    // è·å–æœ€è¿‘Næ ¹Kçº¿
    recentData = U.slice(dataList, -analysisLength)  // è·å–æœ€åNä¸ªå…ƒç´ 
    O.print(`åˆ†ææœ€è¿‘${recentData.length}æ ¹Kçº¿`)
    
    // æå–ä»·æ ¼æ•°æ®
    recentPrices = U.slice(F.attr(dataList, 'close'), -analysisLength)
    
    // è®¡ç®—ç»Ÿè®¡ä¿¡æ¯
    if (recentPrices.length > 0) {
        validPrices = recentPrices.filter(p => U.isValidNumber(p))
        
        if (validPrices.length > 0) {
            avgPrice = U.avg(validPrices)
            maxPrice = U.max(validPrices)
            minPrice = U.min(validPrices)
            
            O.print('è¿‘æœŸå¹³å‡ä»·: ' + avgPrice.toFixed(2))
            O.print('è¿‘æœŸæœ€é«˜ä»·: ' + maxPrice.toFixed(2))
            O.print('è¿‘æœŸæœ€ä½ä»·: ' + minPrice.toFixed(2))
        }
    }
} else {
    O.print('æ•°æ®é‡ä¸è¶³è¿›è¡Œåˆ†æ', 'warn')
}

// åˆ†æ®µåˆ†æç¤ºä¾‹
segmentSize = 20
segments = []

for (let i = 0; i < dataList.length; i += segmentSize) {
    const segment = U.slice(dataList, i, i + segmentSize)
    if (segment.length === segmentSize) {
        segments.push(segment)
    }
}

O.print(`å°†æ•°æ®åˆ†ä¸º${segments.length}ä¸ªæ®µè¿›è¡Œåˆ†æ`)
```

### U.filter() - æ•°ç»„è¿‡æ»¤

æ ¹æ®æ¡ä»¶è¿‡æ»¤æ•°ç»„å…ƒç´ ã€‚

#### è¯­æ³•æ ¼å¼
```javascript
U.filter(array, predicate)
```

#### å‚æ•°è¯¦è§£
| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| `array` | array | âœ… | æºæ•°ç»„ |
| `predicate` | function | âœ… | è¿‡æ»¤æ¡ä»¶å‡½æ•° |

#### å®Œæ•´ç¤ºä¾‹ - ä¿¡å·è¿‡æ»¤ç³»ç»Ÿ
```javascript
//@name=é«˜çº§ä¿¡å·è¿‡æ»¤
//@position=main
//@version=1

// å‚æ•°å®šä¹‰
minVolume = I.int(1000, 'æœ€å°æˆäº¤é‡', 0, 10000)
priceFilter = I.bool(true, 'å¯ç”¨ä»·æ ¼è¿‡æ»¤')
volumeFilter = I.bool(true, 'å¯ç”¨æˆäº¤é‡è¿‡æ»¤')

// è®¡ç®—åŸºç¡€æŒ‡æ ‡
fastMA = F.ma(dataList, 5, 'close')
slowMA = F.ma(dataList, 20, 'close')

// åŸå§‹ä¿¡å·
rawBuySignals = F.throughUp(fastMA, slowMA)
rawSellSignals = F.throughDown(fastMA, slowMA)

// ä¿¡å·è¿‡æ»¤
filteredBuySignals = rawBuySignals.map((signal, index) => {
    if (signal === null) return null
    
    // è·å–å½“å‰Kçº¿æ•°æ®
    const kline = dataList[index]
    if (!kline) return null
    
    // æˆäº¤é‡è¿‡æ»¤
    if (volumeFilter && kline.volume < minVolume) {
        return null
    }
    
    // ä»·æ ¼è¿‡æ»¤ï¼ˆé¿å…åœ¨ä»·æ ¼å¼‚å¸¸æ—¶å‘ä¿¡å·ï¼‰
    if (priceFilter) {
        const priceChange = Math.abs(kline.close - kline.open) / kline.open
        if (priceChange > 0.1) {  // è¶…è¿‡10%çš„ä»·æ ¼å˜åŠ¨
            return null
        }
    }
    
    return signal
})

// ä½¿ç”¨U.filterè¿›è¡Œè¿›ä¸€æ­¥è¿‡æ»¤
validBuySignals = U.filter(filteredBuySignals, signal => signal !== null)
validSellSignals = U.filter(rawSellSignals, signal => signal !== null)

// ç»Ÿè®¡ä¿¡æ¯
O.print(`åŸå§‹ä¹°å…¥ä¿¡å·: ${rawBuySignals.filter(s => s !== null).length}`)
O.print(`è¿‡æ»¤åä¹°å…¥ä¿¡å·: ${validBuySignals.length}`)
O.print(`ä¿¡å·è¿‡æ»¤ç‡: ${(1 - validBuySignals.length / rawBuySignals.filter(s => s !== null).length) * 100}%`)

// ç»˜åˆ¶
fastStyle = S.line('#FF0000', 2, 'solid', title='å¿«çº¿')
slowStyle = S.line('#0000FF', 2, 'solid', title='æ…¢çº¿')
buyStyle = S.shape('arrowUp', '#00FF00', 12, 'lowDown', title='ä¹°å…¥')

D.line(fastMA, fastStyle)
D.line(slowMA, slowStyle)
D.shape(filteredBuySignals, buyStyle)

// è¾“å‡º
setPrecision('price')
O.tools('å¿«çº¿MA5', fastMA, fastStyle)
O.tools('æ…¢çº¿MA20', slowMA, slowStyle)
```

## â° æ—¶é—´å¤„ç†æ–¹æ³•

### U.formatTime() - æ—¶é—´æ ¼å¼åŒ–

å°†æ—¶é—´æˆ³æ ¼å¼åŒ–ä¸ºå¯è¯»å­—ç¬¦ä¸²ã€‚

#### è¯­æ³•æ ¼å¼
```javascript
U.formatTime(timestamp, format?)
```

#### å‚æ•°è¯¦è§£
| å‚æ•° | ç±»å‹ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|------|--------|------|
| `timestamp` | number | âœ… | - | æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰ |
| `format` | string | âŒ | `'YYYY-MM-DD HH:mm:ss'` | æ ¼å¼å­—ç¬¦ä¸² |

#### æ ¼å¼é€‰é¡¹
- `YYYY` - 4ä½å¹´ä»½
- `MM` - 2ä½æœˆä»½
- `DD` - 2ä½æ—¥æœŸ
- `HH` - 24å°æ—¶åˆ¶å°æ—¶
- `mm` - åˆ†é’Ÿ
- `ss` - ç§’

#### ç¤ºä¾‹
```javascript
//@name=æ—¶é—´å¤„ç†å·¥å…·
//@position=main
//@version=1

// è·å–æ—¶é—´ä¿¡æ¯
if (dataList.length > 0) {
    const firstKline = dataList[0]
    const lastKline = dataList[dataList.length - 1]
    
    // æ ¼å¼åŒ–æ—¶é—´
    const startTime = U.formatTime(firstKline.timestamp, 'YYYY-MM-DD HH:mm:ss')
    const endTime = U.formatTime(lastKline.timestamp, 'YYYY-MM-DD HH:mm:ss')
    const tradingDate = U.formatTime(lastKline.timestamp, 'YYYY-MM-DD')
    
    // è¾“å‡ºæ—¶é—´ä¿¡æ¯
    O.print('æ•°æ®å¼€å§‹æ—¶é—´: ' + startTime)
    O.print('æ•°æ®ç»“æŸæ—¶é—´: ' + endTime)
    O.print('äº¤æ˜“æ—¥æœŸ: ' + tradingDate)
    
    // è®¡ç®—æ—¶é—´è·¨åº¦
    const timeSpan = lastKline.timestamp - firstKline.timestamp
    const hours = Math.floor(timeSpan / (1000 * 60 * 60))
    const days = Math.floor(hours / 24)
    
    O.print(`æ•°æ®è·¨åº¦: ${days}å¤©${hours % 24}å°æ—¶`)
}

// åœ¨æ ‡ç­¾ä¸­æ˜¾ç¤ºæ—¶é—´
showTimeLabels = I.bool(false, 'æ˜¾ç¤ºæ—¶é—´æ ‡ç­¾')
if (showTimeLabels) {
    timeLabels = dataList.map((kline, index) => {
        if (index % 50 === 0) {  // æ¯50æ ¹Kçº¿æ˜¾ç¤ºä¸€æ¬¡æ—¶é—´
            return U.formatTime(kline.timestamp, 'MM-DD HH:mm')
        }
        return null
    })
    
    labelStyle = S.label('#FFFFFF', 10, 'center', 'bottom')
    labelBg = S.labelbg('rgba(0,0,0,0.7)', 'fill')
    D.label(timeLabels, labelStyle, labelBg)
}
```

### U.timeframe() - æ—¶é—´å‘¨æœŸè½¬æ¢

å°†æ—¶é—´å‘¨æœŸå­—ç¬¦ä¸²è½¬æ¢ä¸ºæ¯«ç§’æ•°ã€‚

#### è¯­æ³•æ ¼å¼
```javascript
U.timeframe(period)
```

#### å‚æ•°è¯¦è§£
| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| `period` | string | âœ… | æ—¶é—´å‘¨æœŸï¼ˆå¦‚'1m', '1h', '1d'ï¼‰ |

#### æ”¯æŒçš„å‘¨æœŸæ ¼å¼
- `1m`, `5m`, `15m`, `30m` - åˆ†é’Ÿ
- `1h`, `2h`, `4h`, `6h`, `12h` - å°æ—¶  
- `1d`, `3d`, `7d` - å¤©
- `1w` - å‘¨
- `1M` - æœˆ

#### ç¤ºä¾‹
```javascript
//@name=å¤šæ—¶é—´æ¡†æ¶åˆ†æ
//@position=main
//@version=1

// å‚æ•°å®šä¹‰
higherTimeframe = I.select('1h', ['15m', '1h', '4h', '1d'], 'é«˜çº§æ—¶é—´æ¡†æ¶')

// æ—¶é—´å‘¨æœŸè½¬æ¢
currentTF = U.timeframe(chartPeriod)  // å½“å‰å›¾è¡¨å‘¨æœŸçš„æ¯«ç§’æ•°
higherTF = U.timeframe(higherTimeframe)  // é«˜çº§æ—¶é—´æ¡†æ¶çš„æ¯«ç§’æ•°

O.print(`å½“å‰å‘¨æœŸ: ${chartPeriod} (${currentTF}ms)`)
O.print(`é«˜çº§å‘¨æœŸ: ${higherTimeframe} (${higherTF}ms)`)

// è®¡ç®—å‘¨æœŸæ¯”ä¾‹
if (currentTF && higherTF) {
    const ratio = higherTF / currentTF
    O.print(`å‘¨æœŸå€æ•°: ${ratio}`)
    
    // æ ¹æ®æ¯”ä¾‹è°ƒæ•´æŒ‡æ ‡å‚æ•°
    const basePeriod = 20
    const adjustedPeriod = Math.max(1, Math.floor(basePeriod / ratio))
    
    O.print(`è°ƒæ•´åçš„MAå‘¨æœŸ: ${adjustedPeriod}`)
    
    // è®¡ç®—å¹¶ç»˜åˆ¶è°ƒæ•´åçš„MA
    ma = F.ma(dataList, adjustedPeriod, 'close')
    maStyle = S.line('#FF6600', 2, 'solid', title=`MA${adjustedPeriod}`)
    D.line(ma, maStyle)
    
    setPrecision('price')
    O.tools(`MA${adjustedPeriod}(${higherTimeframe})`, ma, maStyle)
}
```

## ğŸš€ å·¥å…·å‡½æ•°ç»¼åˆåº”ç”¨

### æ•°æ®è´¨é‡æ£€æµ‹ç³»ç»Ÿ
```javascript
//@name=æ•°æ®è´¨é‡æ£€æµ‹
//@position=vice
//@version=1

// æ•°æ®è´¨é‡æ£€æµ‹å‡½æ•°
function analyzeDataQuality(data) {
    const results = {
        total: data.length,
        valid: 0,
        invalid: 0,
        nullValues: 0,
        duplicates: 0,
        outliers: 0
    }
    
    // åŸºç¡€éªŒè¯
    data.forEach(item => {
        if (U.isValid(item)) {
            results.valid++
        } else {
            results.invalid++
            if (U.isNull(item)) {
                results.nullValues++
            }
        }
    })
    
    // å¼‚å¸¸å€¼æ£€æµ‹ï¼ˆä½¿ç”¨å››åˆ†ä½æ•°æ–¹æ³•ï¼‰
    const validData = U.filter(data, item => U.isValidNumber(item))
    if (validData.length > 0) {
        const sorted = U.sort([...validData], (a, b) => a - b)
        const q1Index = Math.floor(sorted.length * 0.25)
        const q3Index = Math.floor(sorted.length * 0.75)
        const q1 = sorted[q1Index]
        const q3 = sorted[q3Index]
        const iqr = q3 - q1
        const lowerBound = q1 - 1.5 * iqr
        const upperBound = q3 + 1.5 * iqr
        
        results.outliers = U.filter(validData, val => 
            val < lowerBound || val > upperBound
        ).length
    }
    
    return results
}

// åˆ†æå„ç§æ•°æ®çš„è´¨é‡
const priceData = F.attr(dataList, 'close')
const volumeData = F.attr(dataList, 'volume')

const priceQuality = analyzeDataQuality(priceData)
const volumeQuality = analyzeDataQuality(volumeData)

// è¾“å‡ºåˆ†æç»“æœ
O.print('=== ä»·æ ¼æ•°æ®è´¨é‡åˆ†æ ===')
O.print(`æ€»æ•°æ®ç‚¹: ${priceQuality.total}`)
O.print(`æœ‰æ•ˆæ•°æ®: ${priceQuality.valid} (${(priceQuality.valid/priceQuality.total*100).toFixed(1)}%)`)
O.print(`æ— æ•ˆæ•°æ®: ${priceQuality.invalid}`)
O.print(`å¼‚å¸¸å€¼: ${priceQuality.outliers}`)

O.print('=== æˆäº¤é‡æ•°æ®è´¨é‡åˆ†æ ===')
O.print(`æ€»æ•°æ®ç‚¹: ${volumeQuality.total}`)
O.print(`æœ‰æ•ˆæ•°æ®: ${volumeQuality.valid} (${(volumeQuality.valid/volumeQuality.total*100).toFixed(1)}%)`)
O.print(`æ— æ•ˆæ•°æ®: ${volumeQuality.invalid}`)
O.print(`å¼‚å¸¸å€¼: ${volumeQuality.outliers}`)

// æ•°æ®è´¨é‡è¯„åˆ†
const priceScore = (priceQuality.valid / priceQuality.total) * 100
const volumeScore = (volumeQuality.valid / volumeQuality.total) * 100
const overallScore = (priceScore + volumeScore) / 2

O.print(`æ•°æ®è´¨é‡è¯„åˆ†: ${overallScore.toFixed(1)}/100`)

// æ ¹æ®æ•°æ®è´¨é‡å†³å®šæ˜¯å¦ç»§ç»­è®¡ç®—
if (overallScore > 80) {
    O.notify('æ•°æ®è´¨é‡è‰¯å¥½ï¼Œå¯ä»¥è¿›è¡ŒæŠ€æœ¯åˆ†æ', 'success')
} else if (overallScore > 60) {
    O.notify('æ•°æ®è´¨é‡ä¸€èˆ¬ï¼Œå»ºè®®è°¨æ…åˆ†æ', 'warning')
} else {
    O.notify('æ•°æ®è´¨é‡è¾ƒå·®ï¼Œä¸å»ºè®®è¿›è¡Œåˆ†æ', 'error')
}
```

## ğŸ’¡ æœ€ä½³å®è·µå»ºè®®

### 1. æ•°æ®éªŒè¯ä¼˜å…ˆ
```javascript
// âœ… æ¨èï¼šå…ˆéªŒè¯æ•°æ®å†å¤„ç†
function safeCalculation(data) {
    if (!U.isValid(data) || !U.isArray(data)) {
        O.print('æ•°æ®æ ¼å¼é”™è¯¯', 'error')
        return null
    }
    
    const validData = U.filter(data, item => U.isValidNumber(item))
    if (validData.length === 0) {
        O.print('æ²¡æœ‰æœ‰æ•ˆæ•°æ®', 'warn')
        return null
    }
    
    return U.avg(validData)
}

// ä½¿ç”¨å®‰å…¨è®¡ç®—å‡½æ•°
const prices = F.attr(dataList, 'close')
const avgPrice = safeCalculation(prices)
if (avgPrice !== null) {
    O.print('å®‰å…¨è®¡ç®—çš„å¹³å‡ä»·æ ¼: ' + avgPrice.toFixed(2))
}
```

### 2. æ€§èƒ½ä¼˜åŒ–
```javascript
// âœ… æ¨èï¼šç¼“å­˜è®¡ç®—ç»“æœ
const validPrices = U.filter(F.attr(dataList, 'close'), p => U.isValidNumber(p))

// ä¸€æ¬¡è¿‡æ»¤ï¼Œå¤šæ¬¡ä½¿ç”¨
const priceSum = U.sum(validPrices)
const priceAvg = U.avg(validPrices)  
const priceMax = U.max(validPrices)
const priceMin = U.min(validPrices)

// âŒ é¿å…ï¼šé‡å¤è¿‡æ»¤
// const priceSum = U.sum(U.filter(prices, p => U.isValidNumber(p)))
// const priceAvg = U.avg(U.filter(prices, p => U.isValidNumber(p)))
```

### 3. é”™è¯¯å¤„ç†
```javascript
// âœ… æ¨èï¼šå®Œæ•´çš„é”™è¯¯å¤„ç†
function robustCalculation(data, operation) {
    try {
        if (!U.isValid(data)) {
            throw new Error('æ— æ•ˆæ•°æ®è¾“å…¥')
        }
        
        const result = operation(data)
        
        if (!U.isValidNumber(result)) {
            throw new Error('è®¡ç®—ç»“æœæ— æ•ˆ')
        }
        
        return result
    } catch (error) {
        O.print('è®¡ç®—é”™è¯¯: ' + error.message, 'error')
        return null
    }
}
```

## ğŸ”— ç›¸å…³å†…å®¹

- **æ•°æ®å¤„ç†**: [Fæ–¹æ³•è¯¦è§£](05-è®¡ç®—å‡½æ•°æ–¹æ³•(Fæ–¹æ³•).md) - ä¸Uæ–¹æ³•é…åˆçš„è®¡ç®—å‡½æ•°
- **è°ƒè¯•è¾“å‡º**: [Oæ–¹æ³•è¯¦è§£](07-æ•°æ®è¾“å‡ºæ–¹æ³•(Oæ–¹æ³•).md) - ä½¿ç”¨O.print()è¾“å‡ºUæ–¹æ³•ç»“æœ
- **åŸºç¡€æ¦‚å¿µ**: [åŸºç¡€æ¦‚å¿µå’Œè„šæœ¬ç»“æ„](02-åŸºç¡€æ¦‚å¿µå’Œè„šæœ¬ç»“æ„.md) - JavaScriptè¯­æ³•æ”¯æŒ
- **å®é™…æ¡ˆä¾‹**: [è„šæœ¬æ¡ˆä¾‹åº“](09-å®Œæ•´è„šæœ¬æ¡ˆä¾‹åº“.md) - Uæ–¹æ³•åœ¨å®é™…æŒ‡æ ‡ä¸­çš„åº”ç”¨
- **é”™è¯¯å¤„ç†**: [é”™è¯¯å¤„ç†æŒ‡å—](10-é”™è¯¯å¤„ç†å’Œè°ƒè¯•æŒ‡å—.md) - Uæ–¹æ³•å¸¸è§é—®é¢˜è§£å†³

---
**æç¤º**: Uæ–¹æ³•æ˜¯å¼€å‘åŠ©æ‰‹å·¥å…·åº“ï¼Œå…±26ä¸ªå®ç”¨å‡½æ•°è¦†ç›–æ•°æ®éªŒè¯ã€æ•°å­¦è®¡ç®—ã€æ•°ç»„å¤„ç†ã€æ—¶é—´å¤„ç†ç­‰å¸¸ç”¨éœ€æ±‚ã€‚åˆç†ä½¿ç”¨Uæ–¹æ³•èƒ½æ˜¾è‘—æå‡ä»£ç è´¨é‡å’Œå¼€å‘æ•ˆç‡ã€‚